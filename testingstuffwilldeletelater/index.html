<!DOCTYPE html>
<html>
<head>
  <title>Task Management System</title>
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <script src="custom_blocks.js"></script>
</head>
<body>
  <div id="blocklyWorkspace"></div>
  <script>
    var workspace = Blockly.inject('blocklyWorkspace', {
      toolbox: Blockly.Toolbox.createXml('<xml></xml>'),
      scrollbars: true
    });

    // Initialize database connection when 'Initialize Database' block is executed
    Blockly.addChangeListener(function(event) {
      if (event.type == Blockly.Events.BLOCK_CHANGE && event.block.type == 'initialize_database') {
        // Replace 'tasks.db' with the actual path to your SQLite database file
        var dbConnection = new sqlite3.Database('tasks.db');
        workspace.getVariable('dbConnection').setValue(dbConnection);
      }
    });

    // Create task when 'Create Task' block is executed
    Blockly.addChangeListener(function(event) {
      if (event.type == Blockly.Events.BLOCK_CHANGE && event.block.type == 'create_task') {
        var dbConnection = workspace.getVariable('dbConnection').getValue();
        var name = event.block.getFieldValue('name');
        var description = event.block.getFieldValue('description');
        var dueDate = event.block.getFieldValue('due_date');
        var assignedTo = event.block.getFieldValue('assigned_to');

        dbConnection.execute('INSERT INTO task (name, description, due_date, assigned_to) VALUES (?, ?, ?, ?)',
          [name, description, dueDate, assignedTo]);
      }
    });

    Blockly.addChangeListener(function(event) {
  if (event.type == Blockly.Events.BLOCK_CHANGE && event.block.type == 'update_task_info') {
    var dbConnection = workspace.getVariable('dbConnection').getValue();
    var taskId = event.block.getFieldValue('task_id');
    var name = event.block.getFieldValue('name');
    var description = event.block.getFieldValue('description');
    var dueDate = event.block.getFieldValue('due_date');
    var assignedTo = event.block.getFieldValue('assigned_to');

    var updateStatement = 'UPDATE task SET ';
    var updatedFields = [];

    if (name) {
      updatedFields.push('name = ' + name);
    }

    if (description) {
      updatedFields.push('description = ' + description);
    }

    if (dueDate) {
      updatedFields.push('due_date = ' + dueDate);
    }

    if (assignedTo) {
      updatedFields.push('assigned_to = ' + assignedTo);
    }

    updateStatement += updatedFields.join(', ') + ' WHERE id = ' + taskId;

    dbConnection.execute(updateStatement);
  }
});
  </script>
</body>
</html>

