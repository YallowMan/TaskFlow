<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Task Manager</title>
    <link rel="stylesheet" type="text/css" href="./styles.css">

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
    <!-- NAV BAR -->
    <nav id="toolbar">
        <div class="title-grow">
            <div class="title">Task Manager</div>
            <div class="subtitle">Simple Task Management System.</div>
        </div>

        <a href="https://github.com/your_username/your_task_manager_repo" class="nav_button" target="_blank">View Code</a>
    </nav>
    <!-- END NAV BAR -->

    <!-- PyScript Configuration -->
    <py-config>
        packages = [
            "sqlite3",
            "pandas",
            "numpy",
            "sqlalchemy"
        ]
        plugins = [
            "https://pyscript.net/latest/plugins/python/py_tutor.py"
        ]
    </py-config>

    <div id="pyscriptArea">
        <py-script>
            from js import codeToRun
            import numpy as np
            import pandas as pd 
            from sqlalchemy import create_engine
            import os

            # Run the Blockly generated code (to create/edit/delete tasks in DB).
            exec(codeToRun)

            # Get DB location and open connection.
            user_home_dir = os.path.expanduser("~")
            db_file_path = os.path.join(user_home_dir, "TaskManager.db")

            connection = sqlite3.connect(db_file_path)
            cursor = connection.cursor()

            # Query database on current number of tasks.
            cursor.execute("SELECT COUNT(*) FROM tasks")
            sqlRows = cursor.fetchone()
            numTasks = sqlRows[0]

            # Query all tasks from DB and store locally.
            tasksDF = pd.read_sql('SELECT * FROM tasks', connection)

            # Display completed tasks Panda to user.
            display(tasksDF)

            cursor.close()
            connection.close()
        </py-script>
    </div>

    <script>
        window.onload = function () {
            loadCode();
        };

        // Getting generated Python code, and passing it into PyScript.
        var codeToRun = localStorage.getItem("pythonCode");

        function loadCode() {
            // Save code to localStorage, and launch PyScript for execution.
            code = localStorage.getItem("pythonCode");
            return code;
        }
    </script>
</body>
</html>
